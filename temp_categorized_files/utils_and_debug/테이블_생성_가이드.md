# 🔧 Supabase 테이블 생성 가이드

## ⚠️ 문제 상황
```
Could not find the table 'public.stock_prices' in the schema cache
```
→ **테이블이 생성되지 않았습니다!**

---

## ✅ 해결 방법: Supabase 대시보드에서 테이블 생성

### 📌 준비물
- ✅ `create_tables_simple.sql` 파일 (이미 생성됨)
- ✅ Supabase 계정 및 프로젝트

---

## 🚀 단계별 실행 방법

### **1단계: SQL 파일 복사**

PowerShell에서 실행:
```powershell
# SQL 파일 내용을 클립보드에 복사
Get-Content create_tables_simple.sql | Set-Clipboard
```

또는 `create_tables_simple.sql` 파일을 메모장으로 열어서 전체 선택 후 복사 (Ctrl+A, Ctrl+C)

---

### **2단계: Supabase 대시보드 접속**

1. 브라우저 열기
2. 주소창에 입력: https://supabase.com/dashboard
3. 로그인
4. 프로젝트 선택: **`jvyqmtklymxndtapkqez`**

---

### **3단계: SQL Editor 열기**

왼쪽 사이드바에서:
```
🗄️ SQL Editor 클릭
```

또는 상단 메뉴에서 `SQL Editor` 찾기

---

### **4단계: SQL 실행**

1. **"New query"** 버튼 클릭 (또는 `+` 아이콘)
2. 빈 에디터 창이 나타남
3. **복사한 SQL 전체를 붙여넣기** (Ctrl+V)
4. 우측 하단의 **"Run"** 버튼 클릭 ▶️

---

### **5단계: 테이블 생성 확인**

#### 성공 메시지:
```
All tables created successfully!
```

#### 테이블 확인:
1. 왼쪽 사이드바에서 **"Table Editor"** 클릭
2. 다음 5개 테이블이 생성되어 있어야 함:
   - ✅ `stock_prices`
   - ✅ `index_prices`
   - ✅ `exchange_rates`
   - ✅ `crypto_prices`
   - ✅ `stock_list`

---

## 🎯 테이블 생성 후

### 다시 데이터 업로드 실행:

```powershell
python examples.py
```

선택: `2` (여러 종목)

또는:

```powershell
python supabase_finance_uploader.py
```

---

## 📊 생성되는 테이블 구조

### 1. **stock_prices** (주식 가격)
- symbol (종목코드)
- date (날짜)
- open, high, low, close (OHLC)
- volume (거래량)
- change (변화율)

### 2. **index_prices** (지수)
- stock_prices와 동일 구조

### 3. **exchange_rates** (환율)
- stock_prices와 유사 (소수점 더 정밀)

### 4. **crypto_prices** (암호화폐)
- stock_prices와 유사 (소수점 더 정밀)

### 5. **stock_list** (종목 리스트)
- code (종목코드)
- name (종목명)
- market (시장)
- market_cap (시가총액)

---

## 🔐 보안 설정 (자동 적용됨)

모든 테이블에 **Row Level Security (RLS)** 적용:
- ✅ **읽기**: 누구나 가능
- ✅ **쓰기**: 인증된 사용자만 (anon key로 가능)

---

## ❌ 오류 해결

### 오류 1: "permission denied"
**원인**: RLS 정책 문제  
**해결**: SQL에 이미 정책이 포함되어 있으므로 그대로 실행

### 오류 2: "relation already exists"
**원인**: 테이블이 이미 존재  
**해결**: 문제 없음! `IF NOT EXISTS` 때문에 안전

### 오류 3: SQL 실행 시 타임아웃
**원인**: 네트워크 문제  
**해결**: 다시 Run 클릭

---

## 🎉 완료 확인

테이블 생성 후 다음 명령으로 테스트:

```powershell
python examples.py
```

선택: `1` (삼성전자 1년 데이터)

성공 메시지:
```
✓ 데이터 수집 완료: 242개 레코드
  업로드 진행: 242/242 (100.0%)
✓ 업로드 완료: 242개 레코드
```

---

## 📝 체크리스트

테이블 생성 전:
- [ ] `create_tables_simple.sql` 파일 확인
- [ ] Supabase 대시보드 로그인
- [ ] 프로젝트 선택 확인

테이블 생성:
- [ ] SQL Editor 열기
- [ ] SQL 전체 복사 & 붙여넣기
- [ ] Run 클릭
- [ ] 성공 메시지 확인

테이블 생성 후:
- [ ] Table Editor에서 5개 테이블 확인
- [ ] Python 스크립트로 테스트 업로드
- [ ] 데이터 업로드 성공 확인

---

## 💡 유용한 SQL 쿼리

### 테이블 존재 확인:
```sql
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public'
ORDER BY table_name;
```

### 테이블 삭제 (주의!):
```sql
DROP TABLE IF EXISTS stock_prices CASCADE;
DROP TABLE IF EXISTS index_prices CASCADE;
DROP TABLE IF EXISTS exchange_rates CASCADE;
DROP TABLE IF EXISTS crypto_prices CASCADE;
DROP TABLE IF EXISTS stock_list CASCADE;
```

### 데이터 개수 확인:
```sql
SELECT 
    'stock_prices' as table_name, 
    COUNT(*) as count 
FROM stock_prices
UNION ALL
SELECT 
    'index_prices', 
    COUNT(*) 
FROM index_prices;
```

---

## 📞 도움이 필요하신가요?

1. **Supabase 문서**: https://supabase.com/docs
2. **프로젝트 README**: `README.md` 참고
3. **데이터 가이드**: `FinanceDataReader_데이터_정리.md` 참고

---

**마지막 업데이트**: 2026-01-10
