이제 oracle db mmkt_rate에서 data를 가져와서 금리커브를 그릴건데. 

INPUT:
*curve_name 을 인풋으로 받고 (예: KRWQ3L) 근데 입력창에 KRW 를 입력하면 풀다운 메뉴로 선택가능한 녀석이 뜨도록
*TDATE 도 인풋으로 받을건데 YYYYMMDD 형식으로 받아도 되고 YYYY.MM.DD YYYY-MM-DD 도 되고. 달력 클릭해서 달력에서 선택해도되고
**데이터가 없으면 그다음 TDATE을 선택하되 메세지창 띄워서 "지정하신 날짜([]요일)에 데이타가 없어서 그 다음 데이터를 보여드립니다" 

OUTPUT:
커브를 그려주는데 
*X축에  tenor_name_to_year_fraction 스케일로 나타내는데
명칭은 1년 미만은 6M 9M 로 나타내고 1년이상은 1Y 1.5Y 1.75Y 이런식으로 나타내고 싶어 (함수만들어서 @basic_library/tenor_conventions.py 에 넣어줘)
-> [변경 2026-01-28] 위 라벨 가공은 무시하고, 원래의 tenor_name을 그대로 사용함.
*Y 축에는 MID 값을 나타내고
y축 최소값을 인풋으로 받는 박스가 있어서 
거기에 숫자를 입력하면 반영되어 조정되도록 하고 (디폴트 값은 최소값 - 0.5% )
y축 맥스 값은 실제 max 값 +0.5%
"[입력받을수 있도록함 ]년초과 tenor collapse" 를 슬라이드로 활성화 할수 있어서 이게 활성화가 되면 입력받은 값부터 그다음 테너들은 간격이 1년과 동일하도록
예) "5년초과 tenor collapse" & 5년 초과 테너들이 7년 10년 일경우 5~7, 7~10  x축 간격이 0~1년까지의 간격과 동일하도록

---------------------------
이걸 어떤 형식으로 구현하면 좋을까? 
html + java script는 보안문제때문에 브라우저에서 안 열릴 가능성이 크다고 들었고

streamlit 에 올리는게 좋아보이는데 그건 현재 github repository을 그대로 실행하는건데
이 안에 잡다구리한게 너무 많은데 괜찮을까? 한 reposittory 안에 여러 실행 파일이 있으면 각각을 별개의 streamlit에 연동시키는게 가능하겠지? 근데 기술적으로 streamlit에서 위 조건을 만족하도록 구현할수 있을까? dash + render를 사용해야 하려나? 경험이 없는데 커서를 쓰면 dash + render 도 쉽게 구현할수있을까??

-------------------------------
현재 프롬프트를 prompt_[date&timestamp] 형식의 파일명 txt파일로 저장해 준뒤.
일단 프로젝트 뼈대를 어떻게 가져갈지 제안해줘

-------------------------------
[추가 프롬프트 - 2026-01-28 10:35]
Y축 명칭은 10-11행의 가공 로직을 무시하고 원래 데이터의 tenor_name을 그대로 사용함.
앞으로 추가되는 모든 프롬프트는 이 파일에 계속 누적하여 저장할 것.

-------------------------------
[추가 프롬프트 - 2026-01-28 11:35]
X축과 Y축의 설명을 반대로 했으므로 수정함: X축은 테너(Tenor), Y축은 금리(MID)를 나타냄.
DB에서 가져온 MID 값은 소수점 형태(예: 0.03)이므로, 그래프에 표시할 때는 100을 곱하여 퍼센트(%) 단위로 표시함.
Y축 최소/최대값 계산 및 입력값 처리 시에도 % 단위를 기준으로 함.

-------------------------------
[추가 프롬프트 - 2026-01-28 11:40]
Y축(금리)의 최소/최대 버퍼를 기존 0.5%에서 0.2%로 변경함.
즉, 최소값은 (실제 최소 MID - 0.2%), 최대값은 (실제 최대 MID + 0.2%)가 디폴트임.

-------------------------------
[추가 프롬프트 - 2026-01-28 11:50]
애니메이션 기능을 추가함:
- 시작일/종료일 설정 가능 (디폴트는 가용 데이터의 전체 범위).
- START/STOP 버튼으로 애니메이션 제어.
- 하단 슬라이더 바를 통해 날짜 이동 및 현재 재생 날짜 표시.
- -1년, +1년 이동 버튼 추가.
- 애니메이션 진행 시 날짜가 변경되면서 커브가 실시간으로 교체됨.

-------------------------------
[추가 프롬프트 - 2026-01-28 12:00]
성능 최적화 및 사용자 경험 개선:
- @st.cache_data를 사용하여 데이터 로딩 속도 대폭 개선.
- 애니메이션 실행 시 페이지 전체 리프레쉬(st.rerun) 대신 st.empty() 플레이스홀더를 사용하여 차트만 실시간 업데이트.
- 애니메이션이 약 5초 내외로 완료되도록 프레임 간격 및 스텝 조정.
- 슬라이더 클릭 앤 드래그 시 차트가 즉시 반응하도록 최적화.

-------------------------------
[추가 프롬프트 - 2026-01-28 12:20]
레이아웃 안정성 및 반응성 강화:
- 슬라이더를 차트 **상단**으로 이동하여 차트 업데이트 시 마우스 커서가 이탈하거나 화면이 스크롤되는 현상 방지.
- `select_slider` 대신 인덱스 기반의 일반 `slider`를 사용하여 대량의 날짜 데이터 처리에 대한 반응 속도 개선.
- 차트 높이를 600px로 고정하여 레이아웃 흔들림(Layout Shift) 원천 차단.

-------------------------------
[추가 프롬프트 - 2026-01-28 12:30]
슬라이더 동작 안정화:
- 슬라이더 조작 시 값이 이전으로 돌아가는(Rubber-banding) 현상을 방지하기 위해 `on_change` 콜백 함수 혹은 `session_state`와 위젯 키의 직접 매핑 방식 도입.
- `value` 인자를 제거하고 `key`를 통한 자동 상태 관리를 사용하여 UI와 데이터의 일치성 강화.

-------------------------------
[추가 프롬프트 - 2026-01-28 12:40]
흔적(Trail) 기능 추가:
- 기준일 대비 과거/미래의 커브를 함께 보여주는 기능 추가.
- 설정 항목: 간격(일), 방향당 흔적 개수, 방향(과거, 미래, 양쪽).
- 색상 및 투명도:
    - 기준일 커브: 가장 진한 색상 유지.
    - 과거 흔적: 파란색 계열, 멀어질수록 흐릿하게(최소 투명도 30%).
    - 미래 흔적: 초록색 계열, 멀어질수록 흐릿하게(최소 투명도 30%).
- 날짜 계산: 기준일로부터 `n * 간격`에 해당하는 가장 가까운 실제 데이터 날짜를 찾아 표시.

-------------------------------
[추가 프롬프트 - 2026-01-28 12:50]
애니메이션 UI 및 속도 개선:
- Plotly 내장 슬라이더와 재생 버튼의 겹침 현상을 해결하기 위해 레이아웃(Padding, x/y 좌표) 조정.
- 재생 속도 조절 기능 추가: 사이드바에 x0.1 ~ x10 배속 슬라이더 배치.
- 기본 재생 속도 최적화: 배속이 1.0일 때 전체 기간 애니메이션이 약 5초 내에 완료되도록 각 프레임의 duration 자동 계산.

-------------------------------
[추가 프롬프트 - 2026-01-28 12:10]
애니메이션 재생 시 차트 안정성 강화:
- START ANIMATION 클릭 시, Y축(금리)의 범위를 현재 선택된 전체 기간(Animation Range) 내의 전체 최소/최대값에 0.2% 버퍼를 더한 값으로 고정함.
- 이를 통해 날짜가 바뀔 때마다 Y축 눈동자가 위아래로 흔들리는 현상을 방지함.

-------------------------------
[추가 프롬프트 - 2026-01-28 13:00]
차트 안정성 및 성능 최적화 (안정화 버전으로 원복):
- @st.fragment 사용 시 슬라이더 조작에 따라 차트가 초기화되고 화면이 흐릿해지는 현상이 발생하여 이를 제거함.
- 재생 속도 조절 슬라이더를 사이드바(Sidebar)에서 제거하고 차트 내부 드롭다운(Dropdown)으로 통합하여, 애니메이션 중 실시간 속도 변경 및 불필요한 재렌더링 방지.
- Tenor Collapse 설정(Checkbox, Threshold) 및 Y축 최소값 입력(Y-Axis Min)을 차트 상단 메인 영역으로 이동하여 조작 직관성 강화.
- 프레임당 최소 유지 시간을 보장하도록 속도 로직을 개선하여 배속(0.5x ~ 10.0x) 간의 차이를 확실히 체감할 수 있도록 조정.
- Plotly 네이티브 애니메이션(브라우저 JavaScript 처리) 방식을 유지하여 슬라이더 드래그 및 재생 시 화면 깜빡임과 스크롤 튕김 현상 해결.
- Tenor Collapse 계산 로직을 최적화(Mapping Table 방식)하여 차트 생성 속도 개선.

-------------------------------
[추가 프롬프트 - 2026-01-28 14:15]
레이아웃 정밀 조정 (공백 최적화):
- 차트 모드(지연/캐시)에 따라 하단 여백(Bottom Margin)을 동적으로 조정(80px/180px)하여 차트와 슬라이더 사이의 불필요한 간격 제거.
- 전체 컨테이너의 최소 높이를 각 모드의 실제 콘텐츠 길이에 맞춰 최적화(800px/850px)하여 레이아웃 밀착도 향상.

-------------------------------
[추가 프롬프트 - 2026-01-28 14:30]
재생 속도 체감 및 부드러움 극대화 (60fps 샘플링 로직):
- 브라우저의 최소 리프레시 한계를 극복하기 위해 프레임 속도를 60fps(16.6ms)로 고정.
- 배속에 따라 보여줄 날짜 리스트를 동적으로 샘플링(Sampling)하여 목표 재생 시간을 정확히 맞춤.
    - x1 배속: 20초 동안 약 1,200개 날짜 재생.
    - x10 배속: 2초 동안 약 120개 날짜 재생.
- 이를 통해 저배속과 고배속 간의 차이를 시각적으로 명확하게 구현하고 끊김 없는 애니메이션 제공.
